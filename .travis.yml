language: node_js
node_js:
- stable
- '4'
sudo: false
env:
  matrix:
  - CXX=g++-4.9
  global:
  - secure: QD8wgggmlF0PPOSdQ84JLO9quLMlTDXu3Cg0+UM9yFSyih2ukL/XGn5wxR3B3XmaHfzRqxtrfhjMX6LT7DKFsriolhNVu0kER4zGyrKWK5irxAy2veosyj8qs/R1pXh9qnItlgXrz0fJwpH9o/08q8X+ZjXb0veZ34EMODLbV5zBJXoaHVC6WN62GzInAEEfdB0AEacb44sDIdK++1ujcTFLGnc+LJw8Ck2C/eOWwRhJyiNUrHHTQV3KaM0YtHz+DCz5InC9vWl+BG656AOU5C6PMTvnZ1M3CGfjmXydZoBbDvCQIcB5ylf17tXGoJKevHnmLWm6U3fPVwUwiPiKvisxyNShZw4BEDS7m1b799GnzGOiYsi37aH3G+iAORg1QVqoCAK/yQ77MkkA6a3tlLVHRaInVA6QlFxlbqc8WNlx+fa8lo4L7Y9KPGfr1Bpix/kHQV5JCzKS16Zc7wblTrOvIR/qb8qPfLoxhXi5fUZ3eRuXgR699X1IHJ1LlhkOoBfSiWl88qba01FBLrYSCPeVGb6/N91OFpIlq6eORnzBbc4mtoJSYttvZ45Hu3M5V0KDrGIHr7kNyPThdKr7PVaMXHLCpNrnmBSaxVCU5uhb8Ae3bnLAq/aBxHWZNA8cQ43/s6rS7QqOVJfquXNFYa6V9/QjbU3sJyqIgRzMkAM=
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.9
    - libcairo2-dev
    - libpango1.0-dev
    - libssl-dev
    - libjpeg62-dev
    - libgif-dev
before_script:
- git submodule update --init
- npm install -g gulp
- npm install
script:
- gulp jshint
- gulp minify
- gulp test
- gulp dist
after_script:
- |
  echo HOME: $HOME
  git config user.name "Paper.js Bot"
  git config user.email "bot@paperjs.org"
  git config credential.helper "store --file=.git/credentials"
  echo "https://${GH_TOKEN}:@github.com" > .git/credentials
  mkdir $HOME/tmp
  cp -a dist $HOME/tmp/
  cp -p *.* $HOME/tmp/
  rm $HOME/tmp/dist/.gitignore
  rm $HOME/tmp/gulpfile.js
  git clean -fdx
  git checkout -- .
  git branch -d build --force
  git checkout --orphan build
  git rm -rf .
  mv $HOME/tmp/* .
  rmdir $HOME/tmp
  git add --all *
  git commit -m "Commit built version for $TRAVIS_COMMIT."
  git push -u origin build --force
install:
- |
  wget http://sourceforge.net/p/tellmatic/git/ci/master/tree/img/arial.ttf?format=raw -O arial.ttf
  mkdir -p ~/.fonts
  mv arial.ttf ~/.fonts
  fc-cache -f -v
